# 筹码分布

https://uqer.datayes.com/v3/community/share/59eb7b2e0f66ae010f61d94f

每只个股/每一天都会对应一个分布图，其纵轴是各个价格，横轴是交易量，代表历史上以各个价格建仓买入的量，这就是筹码分布。

筹码分布有很多衍生指标，可以分为下面三类，下面介绍如何使用：
1.形态类，例如："低位密集"个股未来可能会迎来上涨；"高位密集"个股未来会下跌回调；"双峰填谷"代表主力在附近价格吸筹，即将迎来变盘；"低位锁定"代表
主力控盘程度高，
结合当前上涨力度可以判断是否买入

2.衍生指标类，
例如：
"活动筹码ASR"刻画当前价位上下区间的筹码比例，该上下区间的筹码往往是短线投资者活动区域，我们可以利用ASR指标来寻找主力控盘强的个股；
"成本重心CKDW"同样可以用来判断筹码密集程度，CKDW越大说明高位密集状态越明显，反之说明低位密集状态越明显；
"获利盘比例CYQK_C"刻画在当前收盘价对应的获利盘比例，CYQK_C越大说明获利筹码越多，未来上涨阻力越小/上方抛售压力越小；
"价格相对位置PRP"用于判断股价高估程度，PRP越大说明无量超涨且主力控盘程度高，反之说明无量超跌且大部分筹码处于套牢状态，是一种危险信号。

3.实时指标类，同花顺的DDE等大单/主力指标，这里不做深入研究

## 一、筹码分布计算原理

筹码分布理论就是根据股票交易筹码流动的特点，对大盘或个股的历史成交情况进行分析，得出其筹码分布，然后根据这个筹码分布图来预测以后的走势。筹码分析
理论的自然规律基础，是筹码流动的特点。
股票交易都是通过买卖双方在某个价位进行买卖成交而实现的。随着股票的上涨或下跌，在不同的价格区域产生着不同的成交量，这些成交量在不同的价位的分布量，
形成了股票不同价位的持仓成本。
**筹码分布主要应用于筹码持仓成本分析。**一轮行情发展都是由成本转换开始的，又因成本转换而结束。什么是成本转换呢？形象的说，成本转换就是筹码搬家，
是指持仓筹码由一个价位向另一个价位搬运的过程，它不仅仅是股价的转换，更重要的是持仓筹码数量的转换。股票的走势在表象上体现了股价的变化，而其内在的
本质却体现了持仓成本的转换。

2008年之前交易所公布topview数据,每天机构/散户/主力的买入量；之后被交易所叫停，我们只能粗略估算各个价位对应的持仓量，具体方法如下：
使用日间数据，假设成交量服从某种特定分布，按特定时间衰减，进行换手累加得到估计值。

筹码分布估计算法：
输入：个股的o/c/h/l/vol的价格时间序列。可以设置时间窗口n=80
已知当天最低价/最高价/成交量信息，假设这一天内的各个价位的建仓价格符合三角分布，即可求得当天新建仓位的筹码分布。累计筹码分布按一定衰减比例进行累
加最终可求。

curpdf=triang(low,high,vol)
decay=turnoverrate⋅1.0
cumpdf=cumpdf⋅(1−decay)+decay⋅curpdf

相关衍生函数:
1)getcost(quantile)，表示获利盘比例为(quantile)的价格是多少, 取值0~100
2)getwinner(price)，表示以price价格卖出后获利盘的比例是多少，取值为0~1

注: 成交量需要考虑送股等情况, 进行成交量前复权

## 二、选股因子计算原理及选股因子测试

### 2.1 选股因子计算原理

#### 选股因子1: 盈利占比, CYQK_C

定义：当前价位以下的筹码分布占比=getwinner(close)
原理：**当盈利占比很高时，此时市场中大部分投资者都是处于盈利状态，该股票面临抛售压力。**当没有大盘支撑和利好的基本面信息的情况下，该股票在市场上是会
面临供大于求，根据供需理论，会导致股票价格的下跌。
当盈利占比很低时，此时股票的价格也是处于历史比较低的价位。股票价格上涨的空间也比较大。

CYQK_C=getwinner(close)

#### 选股因子2: 活动筹码, ASR

定义：当前价位上下10%的区间中筹码分布的所占比例
原理：该指标值很高时，说明股价处于筹码密集区，反之，当指标值很小时，说明当前股价处于无筹码的真空地带。如果近期股价上涨/下跌时该指标值较小，说明上下
没有明显的支撑/阻力。

ASR=getwinner(close⋅1.1)−getwinner(close⋅0.9)

#### 选股因子3: 成本重心, CKDW

定义: 成本重心CKDW=（平均成本价-最低成本价）/（最高成本价-最低成本价）
原理: 当成本重心（筹码低位密集指标值）很小，筹码分布会呈现低位密集状态。一般股价放量突破单峰密集，会是一轮上涨行情的开始。

CKDW=(mean−min)/(max−min)
注: a. 为了避免极值影响，max/min/mean经过三次正太分布winsorize获得 b. 平均成本=getcost(50)

#### 选股因子4: 价格相对位置, PRP

定义: 价格相对位置PRP=(当前价格-平均成本) / 平均成本
原理：当价格相对位置指标值越小，当前所处的价位就越低。

PRP=(close−mean)/mean
注: a. 为了避免极值影响，mean经过三次正太分布winsorize获得 b. 平均成本=getcost(50)


